<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flag Builder Typing Game</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 20px;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #ffffff 50%, #FFB6C1 100%);
            min-height: 100%;
            color: #2c3e50;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            border: 4px solid #e74c3c;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .instructions {
            font-size: 1.3rem;
            color: #34495e;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .progress-section {
            background: #ecf0f1;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            border: 3px solid #3498db;
        }

        .progress-text {
            font-size: 1.4rem;
            font-weight: bold;
            color: #2980b9;
            margin-bottom: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: #bdc3c7;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #ffffff, #3498db);
            border-radius: 15px;
            transition: width 0.8s ease;
            width: 0%;
        }

        .flag-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            border: 4px solid #2980b9;
            margin-bottom: 30px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .flag {
            width: 400px;
            height: 240px;
            margin: 0 auto 30px;
            border: 3px solid #34495e;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            background: #f8f9fa;
        }

        .flag-piece {
            position: absolute;
            opacity: 0;
            transform: scale(0);
            transition: all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .flag-piece.revealed {
            opacity: 1;
            transform: scale(1);
        }

        /* Red stripes */
        .stripe-1 { top: 0; left: 0; width: 100%; height: 18.5px; background: #e74c3c; }
        .stripe-3 { top: 37px; left: 0; width: 100%; height: 18.5px; background: #e74c3c; }
        .stripe-5 { top: 74px; left: 0; width: 100%; height: 18.5px; background: #e74c3c; }
        .stripe-7 { top: 111px; left: 0; width: 100%; height: 18.5px; background: #e74c3c; }
        .stripe-9 { top: 148px; left: 0; width: 100%; height: 18.5px; background: #e74c3c; }
        .stripe-11 { top: 185px; left: 0; width: 100%; height: 18.5px; background: #e74c3c; }
        .stripe-13 { top: 222px; left: 0; width: 100%; height: 18px; background: #e74c3c; }

        /* White stripes */
        .stripe-2 { top: 18.5px; left: 0; width: 100%; height: 18.5px; background: #ffffff; }
        .stripe-4 { top: 55.5px; left: 0; width: 100%; height: 18.5px; background: #ffffff; }
        .stripe-6 { top: 92.5px; left: 0; width: 100%; height: 18.5px; background: #ffffff; }
        .stripe-8 { top: 129.5px; left: 0; width: 100%; height: 18.5px; background: #ffffff; }
        .stripe-10 { top: 166.5px; left: 0; width: 100%; height: 18.5px; background: #ffffff; }
        .stripe-12 { top: 203.5px; left: 0; width: 100%; height: 18.5px; background: #ffffff; }

        /* Blue canton */
        .blue-canton { 
            top: 0; 
            left: 0; 
            width: 40%; 
            height: 129px; 
            background: #3498db; 
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            line-height: 1.1;
            color: white;
            padding: 5px;
            box-sizing: border-box;
            z-index: 5;
        }

        .typing-area {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 3px solid #e74c3c;
        }

        .current-word {
            font-size: 3rem;
            font-weight: bold;
            color: #2980b9;
            margin-bottom: 20px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 10px;
            border: 2px dashed #3498db;
            padding: 20px;
        }

        .typing-input {
            font-size: 2rem;
            padding: 15px;
            border: 4px solid #3498db;
            border-radius: 10px;
            width: 100%;
            max-width: 300px;
            text-align: center;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            font-weight: bold;
            color: #2c3e50;
        }

        .typing-input:focus {
            outline: none;
            border-color: #e74c3c;
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.3);
        }

        .feedback {
            font-size: 1.5rem;
            font-weight: bold;
            min-height: 40px;
            margin: 20px 0;
        }

        .correct {
            color: #27ae60;
        }

        .completion-screen {
            text-align: center;
            padding: 40px 20px;
            position: relative;
            overflow: hidden;
        }

        .completion-title {
            font-size: 3rem;
            color: #e74c3c;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .completion-message {
            font-size: 1.6rem;
            color: #34495e;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .restart-button {
            background: #27ae60;
            color: white;
            border: none;
            padding: 18px 35px;
            font-size: 1.4rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }

        .restart-button:hover {
            background: #229954;
        }

        .celebration {
            position: absolute;
            pointer-events: none;
            font-size: 2rem;
            animation: celebrate 2s ease-out;
            z-index: 1000;
        }

        @keyframes celebrate {
            0% {
                transform: translateY(0) rotate(0deg) scale(1);
                opacity: 1;
            }
            50% {
                transform: translateY(-50px) rotate(180deg) scale(1.3);
                opacity: 0.9;
            }
            100% {
                transform: translateY(-100px) rotate(360deg) scale(0.8);
                opacity: 0;
            }
        }

        .sparkle {
            position: absolute;
            pointer-events: none;
            font-size: 1.5rem;
            animation: sparkle-fall 3s linear infinite;
            z-index: 1000;
        }

        @keyframes sparkle-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(calc(100% + 200px)) rotate(360deg);
                opacity: 0;
            }
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .flag {
                width: 300px;
                height: 180px;
            }
            
            .current-word {
                font-size: 2.2rem;
            }
            
            .typing-input {
                font-size: 1.5rem;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div class="header">
    <h1 class="title" id="gameTitle">Flag Builder Typing Game</h1>
    <p class="instructions" id="instructionsText">Type the words to build our flag!</p>
    <div style="font-size: 2rem; margin: 15px 0;">
     üá∫üá∏ ‚≠ê üéà ‚≠ê üá∫üá∏
    </div>
   </div>
   <div class="progress-section">
    <div class="progress-text" id="progressText">
     Word 1 of 10
    </div>
    <div class="progress-bar">
     <div class="progress-fill" id="progressFill"></div>
    </div>
   </div>
   <div class="flag-container" id="gameArea">
    <div class="flag" id="flag"><!-- Blue canton with stars - appears first -->
     <div class="flag-piece blue-canton">
      ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê<br>
       ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê<br>
       ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê<br>
       ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê<br>
       ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê<br>
       ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê<br>
       ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê<br>
       ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê<br>
       ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
     </div><!-- Red stripes -->
     <div class="flag-piece stripe-1"></div>
     <div class="flag-piece stripe-3"></div>
     <div class="flag-piece stripe-5"></div>
     <div class="flag-piece stripe-7"></div>
     <div class="flag-piece stripe-9"></div>
     <div class="flag-piece stripe-11"></div>
     <div class="flag-piece stripe-13"></div><!-- White stripes -->
     <div class="flag-piece stripe-2"></div>
     <div class="flag-piece stripe-4"></div>
     <div class="flag-piece stripe-6"></div>
     <div class="flag-piece stripe-8"></div>
     <div class="flag-piece stripe-10"></div>
     <div class="flag-piece stripe-12"></div>
    </div>
    <div class="typing-area">
     <div class="current-word" id="currentWord">
      flag
     </div><input type="text" class="typing-input" id="typingInput" placeholder="Type here..." autocomplete="off">
     <div class="feedback" id="feedback"></div>
    </div>
   </div>
   <div class="completion-screen" id="completionScreen" style="display: none;">
    <h2 class="completion-title">üéâ Fantastic! üéâ</h2>
    <p class="completion-message" id="completionMessage">Amazing! You built the whole flag!</p>
    <div style="font-size: 4rem; margin: 20px 0;">
     üá∫üá∏
    </div>
    <div style="font-size: 2rem; margin: 20px 0;">
     ‚≠ê üéà ‚≠ê üéà ‚≠ê
    </div><button class="restart-button" id="restartButton">Build Another Flag! üöÄ</button>
   </div>
  </div>
  <script>
        // Patriotic words for kindergarteners (2-5 letters)
        const words = ['flag', 'star', 'red', 'blue', 'free', 'home', 'brave', 'hero', 'peace', 'proud'];
        
        // Game state
        let currentWordIndex = 0;
        let gameRecords = [];
        let revealedPieces = 0;

        // Default configuration
        const defaultConfig = {
            game_title: "Flag Builder Typing Game",
            instructions_text: "Type the words to build our flag!",
            completion_message: "Amazing! You built the whole flag!"
        };

        // Data SDK handler
        const dataHandler = {
            onDataChanged(data) {
                gameRecords = data;
            }
        };

        // Element SDK configuration
        const elementConfig = {
            defaultConfig: defaultConfig,
            onConfigChange: async (config) => {
                const title = config.game_title || defaultConfig.game_title;
                const instructions = config.instructions_text || defaultConfig.instructions_text;
                const completion = config.completion_message || defaultConfig.completion_message;

                document.getElementById('gameTitle').textContent = title;
                document.getElementById('instructionsText').textContent = instructions;
                document.getElementById('completionMessage').textContent = completion;
            },
            mapToCapabilities: (config) => ({
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            }),
            mapToEditPanelValues: (config) => new Map([
                ["game_title", config.game_title || defaultConfig.game_title],
                ["instructions_text", config.instructions_text || defaultConfig.instructions_text],
                ["completion_message", config.completion_message || defaultConfig.completion_message]
            ])
        };

        // Initialize SDKs
        async function initializeApp() {
            if (window.dataSdk) {
                const initResult = await window.dataSdk.init(dataHandler);
                if (!initResult.isOk) {
                    console.error("Failed to initialize data SDK");
                }
            }

            if (window.elementSdk) {
                window.elementSdk.init(elementConfig);
            }

            startGame();
        }

        function startGame() {
            currentWordIndex = 0;
            revealedPieces = 0;
            
            // Hide all flag pieces
            const flagPieces = document.querySelectorAll('.flag-piece');
            flagPieces.forEach(piece => {
                piece.classList.remove('revealed');
            });
            
            loadCurrentWord();
            updateProgress();
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('completionScreen').style.display = 'none';
            document.getElementById('typingInput').focus();
        }

        function loadCurrentWord() {
            const currentWord = words[currentWordIndex];
            document.getElementById('currentWord').textContent = currentWord;
            document.getElementById('typingInput').value = '';
            document.getElementById('feedback').textContent = '';
        }

        function updateProgress() {
            const progressPercent = (currentWordIndex / words.length) * 100;
            document.getElementById('progressFill').style.width = progressPercent + '%';
            document.getElementById('progressText').textContent = `Word ${currentWordIndex + 1} of ${words.length}`;
        }

        function checkAnswer() {
            const userInput = document.getElementById('typingInput').value.trim().toLowerCase();
            const currentWord = words[currentWordIndex].toLowerCase();
            const feedback = document.getElementById('feedback');
            
            if (userInput === currentWord) {
                feedback.textContent = 'üéâ Perfect! Great job!';
                feedback.className = 'feedback correct';
                
                // Reveal next piece of flag
                revealNextFlagPiece();
                createCelebration();
                
                // Save progress
                saveProgress();
                
                // Move to next word after a short delay
                setTimeout(() => {
                    currentWordIndex++;
                    if (currentWordIndex >= words.length) {
                        showCompletionScreen();
                    } else {
                        loadCurrentWord();
                        updateProgress();
                    }
                }, 1500);
                
            } else if (userInput.length > 0) {
                feedback.textContent = 'ü§î Try again! You can do it!';
                feedback.className = 'feedback';
            }
        }

        function revealNextFlagPiece() {
            const flagPieces = document.querySelectorAll('.flag-piece');
            
            // Reveal multiple pieces for later words to ensure blue canton appears
            let piecesToReveal = 1;
            if (currentWordIndex >= 7) {
                piecesToReveal = 2; // Reveal 2 pieces for the last 3 words
            }
            
            for (let i = 0; i < piecesToReveal && revealedPieces < flagPieces.length; i++) {
                const piece = flagPieces[revealedPieces];
                piece.classList.add('revealed');
                
                // Special handling for blue canton to ensure it appears on top
                if (piece.classList.contains('blue-canton')) {
                    piece.style.zIndex = '10';
                }
                
                revealedPieces++;
            }
        }

        function createCelebration() {
            const container = document.getElementById('gameArea');
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            celebration.textContent = 'üéâ';
            celebration.style.left = Math.random() * 80 + 10 + '%';
            celebration.style.top = Math.random() * 50 + 25 + '%';
            
            container.appendChild(celebration);
            
            setTimeout(() => {
                if (celebration.parentNode) {
                    celebration.parentNode.removeChild(celebration);
                }
            }, 2000);
        }

        async function saveProgress() {
            if (window.dataSdk && gameRecords.length < 999) {
                const progressRecord = {
                    word_number: currentWordIndex + 1,
                    score: (currentWordIndex + 1) * 10,
                    completed_at: new Date().toISOString()
                };

                const result = await window.dataSdk.create(progressRecord);
                if (!result.isOk) {
                    console.error("Failed to save progress");
                }
            }
        }

        function showCompletionScreen() {
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('completionScreen').style.display = 'block';
            createSparkles();
        }

        function createSparkles() {
            const sparkleEmojis = ['‚ú®', '‚≠ê', 'üéâ', 'üí´', 'üåü', 'üéà'];
            const completionScreen = document.getElementById('completionScreen');
            
            function addSparkle() {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.textContent = sparkleEmojis[Math.floor(Math.random() * sparkleEmojis.length)];
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.animationDelay = Math.random() * 2 + 's';
                sparkle.style.animationDuration = (Math.random() * 2 + 2) + 's';
                
                completionScreen.appendChild(sparkle);
                
                setTimeout(() => {
                    if (sparkle.parentNode) {
                        sparkle.parentNode.removeChild(sparkle);
                    }
                }, 5000);
            }
            
            // Create initial burst
            for (let i = 0; i < 20; i++) {
                setTimeout(addSparkle, i * 100);
            }
            
            // Continue adding sparkles
            const sparkleInterval = setInterval(addSparkle, 300);
            setTimeout(() => clearInterval(sparkleInterval), 8000);
        }

        // Event listeners
        document.getElementById('typingInput').addEventListener('input', checkAnswer);
        
        document.getElementById('typingInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });

        document.getElementById('restartButton').addEventListener('click', startGame);

        // Initialize the app
        initializeApp();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'997c906b6680b02c',t:'MTc2MjAxMjM5Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
